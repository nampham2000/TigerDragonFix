{"version":3,"sources":["file:///C:/Users/Admin/OneDrive/Desktop/dragonfix/assets/Scripts/LoginScript/Connect.ts"],"names":["_decorator","Component","Label","Node","Animation","director","EditBox","Button","input","Input","KeyCode","Colyseus","ccclass","property","loggedInUserSession","NetworkConnect","type","String","Number","Boolean","isKeyPressHandled","client","room","login","email","password","response","fetch","method","headers","body","JSON","stringify","ok","Error","cookies","get","cookiesObject","parse","sessionValue","console","log","localStorage","setItem","LoadingPageProcess","active","loadingAnimProject","play","moveToGameScene","error","Signup","name","WarnEmail","userId","generateUUID","ResTable","ResBtnTb","WarnRes","warnLb","string","d","Date","getTime","uuid","replace","c","r","Math","random","floor","toString","loadScene","onKeyDown","event","keyCode","ENTER","boxNameRes","boxPassRes","boxRePassRes","signUp","scheduleOnce","LoginTable","loginBtn","username","boxNameLogin","boxPassLogin","catch","LoginBtnactive","node","setTimeout","isValidEmail","length","ResBtn","emailPattern","test","start","Client","useSSL","hostname","port","checkToken","getItem","on","EventType","KEY_DOWN","connect"],"mappings":"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","sourcesContent":["import {\r\n  _decorator,\r\n  Component,\r\n  instantiate,\r\n  Label,\r\n  Node,\r\n  Prefab,\r\n  Sprite,\r\n  SpriteFrame,\r\n  tween,\r\n  Vec3,\r\n  Animation,\r\n  director,\r\n  EditBox,\r\n  Button,\r\n  input,\r\n  Input,\r\n  EventKeyboard,\r\n  KeyCode,\r\n} from \"cc\";\r\nconst { ccclass, property } = _decorator;\r\nimport Colyseus from \"db://colyseus-sdk/colyseus.js\";\r\nimport { getToken } from \"../Constant\";\r\n// import { AudioController } from \"./AudioController\";\r\n// import { Chip } from \"./Chip\";\r\nlet loggedInUserSession: any = null;\r\n\r\n@ccclass(\"NetworkConnect\")\r\nexport class NetworkConnect extends Component {\r\n  @property({ type: String })\r\n  hostname = \"localhost\";\r\n\r\n  @property({ type: Number })\r\n  port = 80;\r\n\r\n  @property({ type: Boolean })\r\n  useSSL = true;\r\n\r\n  @property(EditBox)\r\n  private boxNameRes: EditBox = null;\r\n\r\n  @property(EditBox)\r\n  private boxNameLogin: EditBox = null;\r\n\r\n  @property(EditBox)\r\n  private boxPassLogin: EditBox = null;\r\n\r\n  @property(EditBox)\r\n  private boxPassRes: EditBox = null;\r\n\r\n  @property(EditBox)\r\n  private boxRePassRes: EditBox = null;\r\n\r\n  @property(Node)\r\n  private LoadingPageProcess: Node = null;\r\n\r\n  @property(Animation)\r\n  private loadingAnimProject: Animation = null;\r\n\r\n  @property(Node)\r\n  private ResTable: Node;\r\n\r\n  @property(Node)\r\n  private LoginTable: Node;\r\n\r\n  @property(Node)\r\n  private ResBtnTb: Node;\r\n\r\n  @property(Animation)\r\n  private WarnRes: Animation;\r\n\r\n  @property(Animation)\r\n  private WarnEmail: Animation;\r\n\r\n  @property(Button)\r\n  private LoginBtn: Button;\r\n\r\n  @property(Button)\r\n  private ResBtn: Button;\r\n\r\n  @property(Button)\r\n  private LoginBtnactive: Button;\r\n\r\n  @property(Label)\r\n  private warnLb: Label;\r\n\r\n  private isKeyPressHandled: boolean = false;\r\n\r\n  // @property({\r\n  //   type: Chip,\r\n  // })\r\n  // private chipNode: Chip;\r\n\r\n  client!: Colyseus.Client;\r\n  room!: Colyseus.Room;\r\n  // private async login(email: string, password: string) {\r\n  //   try {\r\n  //     //   // Gửi thông tin đăng nhập đến phòng Colyseus\r\n  //     let response = await fetch(\r\n  //       \"https://adroit-appwrite.our-projects.org/v1/account/sessions/email\",\r\n  //       {\r\n  //         method: \"POST\",\r\n  //         headers: {\r\n  //           \"Access-Control-Allow-Origin\": \"*\",\r\n  //           \"Content-Type\": \"application/json\",\r\n  //           \"X-Appwrite-Response-Format\": \"1.5.0\",\r\n  //           \"X-Appwrite-Project\": \"game-provider\",\r\n  //         },\r\n  //         body: JSON.stringify({\r\n  //           email,\r\n  //           password,\r\n  //         }),\r\n  //       }\r\n  //     );\r\n  //     let headers = response.headers;\r\n  //     const cookies = headers.get(\"x-fallback-cookies\");\r\n  //     const cookiesObject = JSON.parse(cookies);\r\n  //     const sessionValue = cookiesObject[\"a_session_game-provider\"];\r\n  //     console.log(cookiesObject);\r\n\r\n  //     localStorage.setItem(\"Token\", sessionValue);\r\n  //     this.LoadingPageProcess.active = true;\r\n  //     this.loadingAnimProject.play();\r\n  //     this.moveToGameScene();\r\n  //   } catch (error) {\r\n  //     console.error(\"Error:\", error);\r\n  //     this.showErrorMessage(\"Incorrect email or password\");\r\n  //   }\r\n  // }\r\n  private async login(email: string, password: string) {\r\n    try {\r\n      // Gửi thông tin đăng nhập đến phòng Colyseus\r\n      let response = await fetch(\r\n        \"https://adroit-appwrite.our-projects.org/v1/account/sessions/email\",\r\n        {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Access-Control-Allow-Origin\": \"*\",\r\n            \"Content-Type\": \"application/json\",\r\n            \"X-Appwrite-Response-Format\": \"1.5.0\",\r\n            \"X-Appwrite-Project\": \"game-provider\",\r\n          },\r\n          body: JSON.stringify({\r\n            email,\r\n            password,\r\n          }),\r\n        }\r\n      );\r\n\r\n      if (!response.ok) {\r\n        throw new Error(\"Incorrect username or password\");\r\n      }\r\n\r\n      let headers = response.headers;\r\n      const cookies = headers.get(\"x-fallback-cookies\");\r\n      const cookiesObject = JSON.parse(cookies);\r\n      const sessionValue = cookiesObject[\"a_session_game-provider\"];\r\n      console.log(cookiesObject);\r\n\r\n      localStorage.setItem(\"Token\", sessionValue);\r\n      this.LoadingPageProcess.active = true;\r\n      this.loadingAnimProject.play();\r\n      this.moveToGameScene();\r\n    } catch (error) {\r\n      console.error(\"Error:\", error);\r\n      throw new Error(\"Incorrect username or password\");\r\n    }\r\n  }\r\n\r\n  private async Signup(email: string, password: string, name: string) {\r\n    if (!email || !password || !name) {\r\n      this.WarnEmail.play(\"WarningEmail\");\r\n      return;\r\n    }\r\n    try {\r\n      // Gửi thông tin đăng nhập đến phòng Colyseus\r\n      let response = await fetch(\r\n        \"https://adroit-appwrite.our-projects.org/v1/account\",\r\n        {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Access-Control-Allow-Origin\": \"*\",\r\n            \"Content-Type\": \"application/json\",\r\n            \"X-Appwrite-Response-Format\": \"1.5.0\",\r\n            \"X-Appwrite-Project\": \"game-provider\",\r\n          },\r\n          body: JSON.stringify({\r\n            userId: this.generateUUID(),\r\n            email: email,\r\n            password: password,\r\n            name: name,\r\n          }),\r\n        }\r\n      );\r\n\r\n      if (response.ok) {\r\n        if (this.ResTable && this.ResBtnTb) {\r\n          this.ResTable.active = false;\r\n          this.ResBtnTb.active = false;\r\n          this.WarnRes.play();\r\n        }\r\n      } else {\r\n        this.warnLb.string = \"Account already exists\";\r\n        this.WarnEmail.play();\r\n      }\r\n    } catch (error) {\r\n      this.warnLb.string = \"Account already exists\";\r\n      this.WarnEmail.play();\r\n    }\r\n  }\r\n  generateUUID() {\r\n    let d = new Date().getTime();\r\n    const uuid = \"xxxxxxxxxxxxxxxyxxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\r\n      const r = (d + Math.random() * 16) % 16 | 0;\r\n      d = Math.floor(d / 16);\r\n      return (c === \"x\" ? r : (r & 0x3) | 0x8).toString(16);\r\n    });\r\n    return uuid;\r\n  }\r\n\r\n  private moveToGameScene() {\r\n    // Chuyển đến scene chơi game\r\n    director.loadScene(\"Game\");\r\n  }\r\n\r\n  onKeyDown(event: EventKeyboard) {\r\n    if (this.isKeyPressHandled) return;\r\n    switch (event.keyCode) {\r\n      case KeyCode.ENTER:\r\n        // If the signup form is active, attempt to sign up\r\n        if (this.ResTable && this.ResTable.active === true) {\r\n          const email = this.boxNameRes.string;\r\n          const password = this.boxPassRes.string;\r\n          const name = this.boxRePassRes.string;\r\n          this.signUp(email, password, name);\r\n          this.isKeyPressHandled = true;\r\n          this.scheduleOnce(() => {\r\n            this.isKeyPressHandled = false;\r\n          }, 4);\r\n        }\r\n        if(this.LoginTable&&this.LoginTable.active)\r\n          {\r\n            \r\n          }\r\n        break;\r\n    }\r\n  }\r\n\r\n  private loginBtn() {\r\n    const username = this.boxNameLogin.string;\r\n    const password = this.boxPassLogin.string;\r\n\r\n    // Kiểm tra username và password không được để trống\r\n    if (!username) {\r\n      this.warnLb.string = \" Email, password must not be empty\";\r\n      this.WarnEmail.play();\r\n      return;\r\n    }\r\n\r\n    if (!password) {\r\n      this.warnLb.string = \" Email, password must not be empty\";\r\n      this.WarnEmail.play();\r\n      return;\r\n    }\r\n\r\n    // Thực hiện đăng nhập\r\n    this.login(username, password).catch((error: any) => {\r\n      this.warnLb.string = \"Incorrect username or password\";\r\n      this.WarnEmail.play();\r\n    });\r\n\r\n    this.LoginBtnactive.node.active = true;\r\n    setTimeout(() => {\r\n      this.LoginBtnactive.node.active = false;\r\n    }, 3000);\r\n  }\r\n\r\n  private signUp(email: string, password: string, name: string) {\r\n    email = this.boxNameRes.string;\r\n    password = this.boxPassRes.string;\r\n    name = this.boxRePassRes.string;\r\n\r\n    if (!email) {\r\n      this.warnLb.string = \" Email, password, and name must not be empty\";\r\n      this.WarnEmail.play();\r\n      return;\r\n    }\r\n    if (!password) {\r\n      this.warnLb.string = \" Email, password, and name must not be empty\";\r\n      this.WarnEmail.play();\r\n      return;\r\n    }\r\n    if (!name) {\r\n      this.warnLb.string = \" Email, password, and name must not be empty\";\r\n      this.WarnEmail.play();\r\n      return;\r\n    }\r\n\r\n    // Kiểm tra email hợp lệ\r\n    if (!this.isValidEmail(email)) {\r\n      this.warnLb.string = \"Invalid email address\";\r\n      this.WarnEmail.play();\r\n      return;\r\n    }\r\n\r\n    // Kiểm tra độ dài mật khẩu\r\n    if (password.length < 8) {\r\n      this.warnLb.string = \"Password must be at least 8 characters long\";\r\n      this.WarnEmail.play();\r\n      return;\r\n    }\r\n\r\n    // Thực hiện đăng ký\r\n    this.Signup(email, password, name);\r\n    this.ResBtn.node.active = true;\r\n    setTimeout(() => {\r\n      this.ResBtn.node.active = false;\r\n    }, 3000);\r\n  }\r\n\r\n  private isValidEmail(email: string): boolean {\r\n    const emailPattern = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    return emailPattern.test(email);\r\n  }\r\n\r\n  // Phương thức để xử lý kết quả đăng nhập từ server\r\n  // private handleLoginResponse(response: any) {\r\n  //   if (response.success) {\r\n  //     // Nếu đăng nhập thành công, chuyển đến scene game\r\n  //     this.moveToGameScene();\r\n  //   } else {\r\n  //     // Nếu đăng nhập thất bại, hiển thị thông báo lỗi\r\n  //     this.showErrorMessage(\"Incorrect email or password\");\r\n  //   }\r\n  // }\r\n\r\n  start() {\r\n    // Khởi tạo kết nối đến Colyseus và gọi phương thức connect\r\n    this.client = new Colyseus.Client(\r\n      `${this.useSSL ? \"wss\" : \"ws\"}://${this.hostname}:${this.port}`\r\n    );\r\n    const uuid = this.generateUUID();\r\n    const checkToken = localStorage.getItem(\"key\");\r\n    if (checkToken) {\r\n      this.LoadingPageProcess.active = true;\r\n      this.loadingAnimProject.play();\r\n      this.moveToGameScene();\r\n    } else {\r\n    }\r\n    input.on(Input.EventType.KEY_DOWN, this.onKeyDown, this);\r\n    // this.connect();\r\n  }\r\n\r\n  async connect() {\r\n    // try {\r\n    // this.client.auth.token =\r\n    //   \"eyJpZCI6IjY2MWUyNmFmMDAzOWVjOGFhNDc1Iiwic2VjcmV0IjoiNjQ2MTQ5N2U0YjNiY2I3ODUwM2VjZmZhZmJiMWI2ZmJjNTViNmYwNWM5MTJkYmYxMDIxYzY5YWY3Mjc1MTU5NDkyNzk0Y2ZjMTE5OTU4OTRhYTJjZWViYWZmZDZlZjQxZmQ4ODNiMDQ1NmVkMmQzNzU4YmY3OGI3MjRmYWNjN2MxNzVjNzFkNDU1ZDlhZmM1OTNiMjQwMDBiMDVkNDYyMzZjMzBhYTM4MWVmZTM4ZWVlMDU5OTVmMDYwMTkwMTk3ODMxOGI0OWIxYjIwYjg0ZDMyODVkMGQyMzA2ZmY0NWMyNzk0MjdmZjkzZmNmYzdmYTNiMjAyNzE1MTQ4ZDE3YiJ9\";\r\n    // // this.client.joinOrCreate(\"room1\").then((room) => {\r\n    // //   console.log(room);\r\n    // // });\r\n    // // Kết nối đến Colyseus và tham gia vào phòng\r\n    // const rooms = await this.client.getAvailableRooms(\"room1\");\r\n    // if (rooms.length === 0) {\r\n    //   this.room = await this.client.create(\"room1\");\r\n    //   // console.log(\"Created new room with sessionId:\", this.room.sessionId);\r\n    // } else {\r\n    //   // // Nếu có phòng có sẵn, tham gia vào phòng đầu tiên trong danh sách\r\n    //   this.room = await this.client.joinById(rooms[0].roomId);\r\n    //   console.log(\r\n    //     \"Joined existing room with sessionId:\",\r\n    //     this.room.sessionId\r\n    //   );\r\n    //   }\r\n    //   console.log(\"Joined successfully!\");\r\n    //   console.log(\"User's sessionId:\", this.room.sessionId);\r\n    //   this.room.onMessage(\"loginResult\", (message) => {\r\n    //     if (message) {\r\n    //       console.log(message);\r\n    //       // this.LoadingNode.active = true;\r\n    //       localStorage.setItem(\"key\", message.secret);\r\n    //       console.log(message);\r\n    //       this.moveToGameScene();\r\n    //     } else {\r\n    //       console.log(\"Not define\");\r\n    //     }\r\n    //   });\r\n    // } catch (e) {\r\n    //   console.error(\"Error:\", e);\r\n    // }\r\n  }\r\n}\r\n"]}