{"version":3,"sources":["file:///Users/waostudio/Desktop/dragonfix/assets/Scripts/NetworkConnect.ts"],"names":["_decorator","Component","instantiate","Label","Node","Prefab","Sprite","SpriteFrame","tween","Vec3","Animation","Colyseus","AudioController","Chip","ccclass","property","NetworkConnect","type","String","Number","Boolean","parentNodeChip","client","room","gameState","resultDragon","resultTiger","TotalUser","UserBet","NotmeBet","result","winner","currentHost","balanceUser","TotalBalanceUser","betDragon","betTiger","betTie","totaluserBetDragon","totaluserBetTiger","totaluserBetTie","dragonReuslt","tigerResult","namePlayer","winnerPLayer","start","Client","useSSL","hostname","port","connect","auth","token","localStorage","getItem","rooms","getAvailableRooms","length","create","console","log","sessionId","joinById","roomId","users","onMessage","message","TimerDown","string","onAudio","PayoutAnim","winAnimPlus","usercancel","state","players","get","playerId","displayName","i","ListLabel","node","removeAllChildren","betAmount","playerID","betType","createSpriteNode","balance","setInterval","send","onStateChange","roundState","totalBetDragon","totalBetTiger","totalBetTie","totalUserBetDragon","totalUserBetTiger","totalUserBetTie","currentHostId","values","updatePlayerList","onLeave","code","e","error","playerList","displayIndex","list","numElements","ListL","forEach","active","value","key","nameUser","warn","prefab","prefabs","spriteNode","scale","v3","PosTarget","DragonNode","ChipParent","TigerNode","TieNode","addChild","inverseTransformPoint","worldPosition","to","position","winnerList","winnerNode","findWinnerNode","PayUser","createSpriteNodePay","x","y","PayUserSprite","winid","CoinWinAni","price","toString","getComponent","play","winnerName","posX","posY","spriteFrames","spriteComponent","addComponent","spriteFrame","delay","call"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Component,\n  instantiate,\n  Label,\n  Node,\n  Prefab,\n  Sprite,\n  SpriteFrame,\n  tween,\n  Vec3,\n  Animation,\n} from \"cc\";\n\nconst { ccclass, property } = _decorator;\nimport Colyseus from \"db://colyseus-sdk/colyseus.js\";\nimport { AudioController } from \"./AudioController\";\nimport { Chip } from \"./Chip\";\n@ccclass(\"NetworkConnect\")\nexport class NetworkConnect extends Component {\n  @property({ type: String })\n  hostname = \"localhost\";\n\n  @property({ type: Number })\n  port = 80;\n\n  @property({ type: Boolean })\n  useSSL = true;\n\n  @property({ type: Node })\n  private ListL: Node[] = [];\n\n  @property({ type: Label })\n  public ListLabel: Label[] = [];\n\n  @property(Label)\n  private TimerDown: Label;\n\n  @property(Label)\n  private CoinWinAni: Label;\n\n  @property({\n    type: Chip,\n  })\n  private chipNode: Chip;\n\n  @property({\n    type: Prefab,\n  })\n  private prfab: Prefab;\n\n  @property({\n    type: Node,\n  })\n  private DragonNode: Node;\n\n  @property({\n    type: Node,\n  })\n  private TigerNode: Node;\n\n  @property({\n    type: Node,\n  })\n  private TieNode: Node;\n\n  @property({\n    type: Node,\n  })\n  private PayUser: Node;\n\n  @property({ type: Node })\n  private ChipParent: Node[] = [];\n\n  @property({ type: Prefab })\n  public prefabs: Prefab[] = [];\n\n  parentNodeChip;\n\n  client!: Colyseus.Client;\n  room!: Colyseus.Room;\n  gameState;\n  resultDragon: number = 0;\n  resultTiger: number = 0;\n  TotalUser;\n  UserBet;\n  NotmeBet;\n  result;\n  winner;\n  currentHost: any;\n  balanceUser: any;\n  TotalBalanceUser: any;\n  betDragon: any;\n  betTiger: any;\n  betTie: any;\n  totaluserBetDragon: any;\n  totaluserBetTiger: any;\n  totaluserBetTie: any;\n  dragonReuslt;\n  tigerResult;\n  namePlayer;\n  winnerPLayer;\n  @property({\n    type: AudioController,\n  })\n  private AudioController: AudioController;\n\n  @property({\n    type: SpriteFrame,\n  })\n  private PayUserSprite: SpriteFrame[] = [];\n\n  async start() {\n    this.client = new Colyseus.Client(\n      `${this.useSSL ? \"wss\" : \"ws\"}://${this.hostname}:${this.port}`\n    );\n\n    this.connect();\n  }\n\n  async connect() {\n    try {\n      this.client.auth.token = localStorage.getItem(\"Token\");\n      // this.room = await this.client.joinOrCreate(\"room1\");\n      const rooms = await this.client.getAvailableRooms(\"room1\");\n      if (rooms.length === 0) {\n        this.room = await this.client.create(\"room1\");\n        console.log(\"Created new room with sessionId:\", this.room.sessionId);\n      } else {\n        // Nếu có phòng có sẵn, tham gia vào phòng đầu tiên trong danh sách\n        this.room = await this.client.joinById(rooms[0].roomId);\n        console.log(\n          \"Joined existing room with sessionId:\",\n          this.room.sessionId\n        );\n      }\n      const users = {};\n\n      // Sự kiện được kích hoạt khi một người dùng tham gia vào phòng\n      console.log(\"Joined successfully!\");\n      console.log(\"User's sessionId:\", this.room.sessionId);\n      // this.room.send(\n      //   \"signup\",\n      //   JSON.stringify({\n      //     email: \"nampham78934@gmail.com\",\n      //     password: \"nam123455664\",\n      //   })\n      // );\n\n      this.room.onMessage(\"timer\", (message) => {\n        this.TimerDown.string = message;\n        if (message < 30 && message > 0) {\n          this.AudioController.onAudio(3);\n        }\n        if (message === 0) {\n          this.AudioController.onAudio(4);\n        }\n      });\n\n      this.room.onMessage(\"winnerList\", (message) => {\n        this.PayoutAnim(message);\n        this.winAnimPlus(message);\n      });\n\n      this.room.onMessage(\"userCancel\", (message) => {\n        const usercancel = this.room.state.players.get(\n          message.playerId\n        ).displayName;\n        for (let i = 0; i < this.ListLabel.length; i++) {\n          if (usercancel === this.ListLabel[i].string) {\n            this.ListLabel[i].node.removeAllChildren();\n          }\n        }\n      });\n\n      this.room.onMessage(\"result\", (message) => {\n        // console.log(message.result);\n        this.result = message.result;\n      });\n\n      this.room.onMessage(\"userBet\", (message) => {\n        console.log(message.betAmount);\n\n        this.namePlayer = this.room.state.players.get(message.playerID);\n        if (message.playerID != this.room.sessionId) {\n          this.UserBet = message.betType;\n          this.createSpriteNode(this.namePlayer.displayName, message.betAmount);\n        } else {\n          // console.log(\"false\");\n        }\n      });\n\n      this.room.onMessage(\"balance\", (message) => {\n        this.balanceUser = message.balance;\n        console.log(message);\n      });\n      setInterval(() => {\n        this.room.send(\"getBalance\");\n      }, 500);\n\n      this.room.onStateChange((state) => {\n        console.log(\"Room state changed:\", state);\n        console.log(\"onStateChange: \", state);\n        console.log(state.roundState);\n\n        this.betDragon = state.totalBetDragon;\n        this.betTiger = state.totalBetTiger;\n        this.betTie = state.totalBetTie;\n        this.totaluserBetDragon = state.totalUserBetDragon;\n        this.totaluserBetTiger = state.totalUserBetTiger;\n        this.totaluserBetTie = state.totalUserBetTie;\n\n        // console.log(this.room.state);\n        this.currentHost = state.currentHostId;\n        const players = [...state.players.values()];\n        this.updatePlayerList(players);\n        // console.log(\"PlayerStatus\", players[0].isHost);\n        this.TotalUser = players.length;\n        this.gameState = state.roundState;\n      });\n\n      this.room.onLeave((code) => {\n        console.log(\"Left room with code:\", code);\n      });\n    } catch (e) {\n      console.error(\"Error:\", e);\n    }\n  }\n\n  updatePlayerList(playerList: any[]) {\n    let displayIndex = 0;\n\n    [\n      {\n        0: [{}],\n      },\n    ];\n\n    // // Lấy từng giá trị value từ\n    const list = playerList[0];\n\n    const numElements = list.length;\n\n    this.ListL.forEach((node) => {\n      node.active = false;\n    });\n\n    list.forEach((value: any, key: any) => {\n      if (\n        value.sessionId !== this.room.sessionId &&\n        value.sessionId !== this.currentHost\n      ) {\n        const nameUser = value.displayName;\n        if (nameUser) {\n          // Check if nameUser is defined\n          this.ListLabel[displayIndex].string = nameUser;\n          this.ListL[displayIndex].active = true;\n          displayIndex++;\n          this.AudioController.onAudio(9);\n        } else {\n          console.warn(\n            `Player with sessionId ${value.sessionId} not found in room state.`\n          );\n        }\n      }\n    });\n\n    // for (let i = 0; i < numElements && displayIndex < this.ListL.length; i++) {\n    //   if (\n    //     list[i].sessionId !== this.room.sessionId &&\n    //     list[i].sessionId !== this.currentHost\n    //   ) {\n    //     const nameUser = list[i];\n    //     console.log(\"PLayerIaddddddddd\", playerList[i].sessionId);\n\n    //     console.log(\"NAMEUSERRRRRRRRRRRRR\", nameUser);\n    //     if (nameUser) {\n    //       // Check if nameUser is defined\n    //       this.ListLabel[displayIndex].string = nameUser.displayName;\n    //       this.ListL[displayIndex].active = true;\n    //       displayIndex++;\n    //       this.AudioController.onAudio(9);\n    //     } else {\n    //       console.warn(\n    //         `Player with sessionId ${playerList[i].sessionId} not found in room state.`\n    //       );\n    //     }\n    //   }\n    // }\n    for (let i = displayIndex; i < this.ListL.length; i++) {\n      this.ListL[i].active = false;\n    }\n  }\n\n  private createSpriteNode(sessionId: string, betAmount: number) {\n    if (betAmount < 1 || betAmount > 6) {\n      console.error(\"Invalid betAmount:\", betAmount);\n      return;\n    }\n\n    // Lấy prefab tương ứng với betAmount\n    const prefab = this.prefabs[betAmount - 1];\n    const spriteNode = instantiate(prefab);\n    spriteNode.scale = new Vec3(0.5, 0.5);\n    let v3 = new Vec3();\n    let PosTarget;\n\n    // Kiểm tra nếu sessionId trùng khớp với label nào đó\n    for (let i = 0; i < this.ListLabel.length; i++) {\n      if (sessionId === this.ListLabel[i].string) {\n        // Thêm node mới làm con của node có label tương ứng\n        if (this.UserBet === \"Dragon\") {\n          PosTarget = this.DragonNode;\n          this.parentNodeChip = this.ChipParent[0];\n        } else if (this.UserBet === \"Tiger\") {\n          PosTarget = this.TigerNode;\n          this.parentNodeChip = this.ChipParent[1];\n        } else {\n          PosTarget = this.TieNode;\n          this.parentNodeChip = this.ChipParent[2];\n        }\n        this.ListLabel[i].node.addChild(spriteNode);\n        this.ListLabel[i].node.inverseTransformPoint(\n          v3,\n          PosTarget.worldPosition\n        );\n        tween(spriteNode).to(0.3, { position: v3 }).start();\n        break;\n      }\n    }\n  }\n\n  private PayoutAnim(winnerList) {\n    if (winnerList.length > 0) {\n      this.AudioController.onAudio(6);\n    }\n\n    // Lặp qua danh sách người chiến thắng và tạo nút trả tiền cho mỗi người chiến thắng\n    for (let i = 0; i < winnerList.length; i++) {\n      const winner = this.room.state.players.get(\n        winnerList[i].sessionId\n      ).displayName;\n\n      // Tìm node tương ứng với người chiến thắng\n      const winnerNode = this.findWinnerNode(winner);\n\n      if (winnerNode) {\n        let v3 = new Vec3();\n        this.PayUser.inverseTransformPoint(v3, winnerNode.worldPosition);\n        // Tạo nút trả tiền cho người chiến thắng\n        this.createSpriteNodePay(v3.x, v3.y, this.PayUserSprite);\n      }\n    }\n  }\n  private winAnimPlus(winid) {\n    for (let i = 0; i < winid.length; i++) {\n      if (winid[i].sessionId === this.room.sessionId) {\n        this.CoinWinAni.string = \"+\" + winid[i].price.toString();\n        this.CoinWinAni.node.active = true;\n        this.CoinWinAni.node.getComponent(Animation).play();\n        break; // Nếu tìm thấy phần tử thỏa mãn, dừng vòng lặp\n      }\n    }\n  }\n\n  // Hàm để tìm node tương ứng với người chiến thắng\n  private findWinnerNode(winnerName) {\n    // Lặp qua danh sách nhãn để tìm node có tên trùng khớp với người chiến thắng\n    for (let i = 0; i < this.ListLabel.length; i++) {\n      if (winnerName === this.ListLabel[i].string) {\n        return this.ListLabel[i].node;\n      }\n    }\n    return null; // Trả về null nếu không tìm thấy node\n  }\n\n  createSpriteNodePay(posX, posY, spriteFrames: SpriteFrame[]) {\n    // Lặp qua từng sprite frame để tạo node tương ứng\n    for (let i = 0; i < spriteFrames.length; i++) {\n      // Tạo một Node mới\n      const spriteNode = new Node(\"SpriteNode\");\n      spriteNode.scale = new Vec3(0.5, 0.5);\n\n      // Thêm một component Sprite vào Node\n      const spriteComponent = spriteNode.addComponent(Sprite);\n\n      // Gán SpriteFrame cho component Sprite dựa trên index\n      spriteComponent.spriteFrame = spriteFrames[i];\n\n      // Thêm Node vào Scene hiện tại (ví dụ: Node cha của tất cả Sprite)\n      this.PayUser.addChild(spriteNode); // Giả sử winner.node là node của người chiến thắng\n\n      // Tween Node đến vị trí mong muốn\n      tween(spriteNode)\n        .delay(i * 0.1) // thiết lập thời gian trễ dựa trên index của node\n        .to(1, { position: new Vec3(posX, posY) })\n        .call(() => {\n          spriteNode.active = false;\n        })\n        .start();\n    }\n  }\n}\n"]}